{
  "openapi": "3.0.1",
  "info": {
    "title": "API du portail de l'Affichage Environnemental",
    "description": "La version numérique de ce document est accessible [ici](https://affichage-environnemental.ecobalyse.beta.gouv.fr/api/documentation).<br/>La route `POST /produits` qui permet de déclarer des produits est basée sur [l'API Écobalyse](https://ecobalyse.beta.gouv.fr/versions/v7.0.0/#/api).<br/>Il faut en plus rajouter les informations réglementaires de son produit, à savoir : les codes GTINs et la référence interne.<br/>Certaines routes nécessite d'être authentifié avec un `Bearer token`.<br/>Vous pouvez le générer sur votre [page API](https://affichage-environnemental.ecobalyse.beta.gouv.fr/api).",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://affichage-environnemental.ecobalyse.beta.gouv.fr/api"
    }
  ],
  "paths": {
    "/produits": {
      "get": {
        "security": [
          {
            "bearer": []
          }
        ],
        "tags": ["Consultation"],
        "summary": "Récupère tous les produits de l'organisation",
        "description": "Permet de consulter la liste paginée de tous les produits déclarés par l'organisation",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "Numéro de la page à récupérer (commence à 0)",
            "example": 1
          },
          {
            "name": "size",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 10
            },
            "description": "Nombre d'éléments par page (maximum 100)",
            "example": 10
          },
          {
            "name": "brandId",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Filtre par marque id (optionnel)",
            "example": "Ecopass"
          }
        ],
        "responses": {
          "200": {
            "description": "Liste paginée des produits de l'organisation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ProductResponse"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Paramètres de pagination invalides",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InvalidParametersError"
                }
              }
            }
          },
          "401": {
            "description": "Authentification requise - L'utilisateur doit fournir un token Bearer valide dans l'en-tête Authorization. Cette erreur survient si le token est manquant, invalide ou expiré.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UnauthorizedError"
                }
              }
            }
          }
        }
      },
      "post": {
        "security": [
          {
            "bearer": []
          }
        ],
        "tags": ["Déclaration"],
        "summary": "Déclare un produit sur le portail de l'Affichage Environnemental.",
        "requestBody": {
          "description": "Requête modélisant les paramètres du produit à déclarer",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ProductQuery"
              },
              "examples": {
                "tShirtFrance": {
                  "$ref": "#/components/examples/tShirtFrance"
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Déclaration validée",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "description": "Déclaration réussie.",
                  "properties": {
                    "result": {
                      "type": "string",
                      "enum": ["success"]
                    }
                  }
                }
              }
            }
          },
          "208": {
            "description": "La nouvelle déclaration est identique à l'ancienne",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "enum": ["Le produit existe déjà."]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Paramètres invalides",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InvalidParametersError"
                }
              }
            }
          },
          "401": {
            "description": "Authentification requise - L'utilisateur doit fournir un token Bearer valide dans l'en-tête Authorization. Cette erreur survient si le token est manquant, invalide ou expiré.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UnauthorizedError"
                }
              }
            }
          }
        }
      }
    },
    "/produits/lot": {
      "post": {
        "security": [
          {
            "bearer": []
          }
        ],
        "tags": ["Déclaration"],
        "summary": "Déclare un lot de produits sur le portail de l'Affichage Environnemental.",
        "description": "Permet de déclarer plusieurs produits regroupés en lot. Tous les produits du lot partagent les mêmes métadonnées (GTINs, référence interne, marque, score déclaré) mais peuvent avoir des informations techniques différentes (matériaux, pays, etc.).",
        "requestBody": {
          "description": "Requête modélisant les paramètres du lot de produits à déclarer",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ProductBatchQuery"
              },
              "examples": {
                "lotTShirts": {
                  "$ref": "#/components/examples/lotTShirts"
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Déclaration de lot validée",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "description": "Déclaration de lot réussie.",
                  "properties": {
                    "result": {
                      "type": "string",
                      "enum": ["success"]
                    }
                  }
                }
              }
            }
          },
          "208": {
            "description": "Le nouveau lot est identique à l'ancien",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "enum": ["Le produit existe déjà."]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Paramètres invalides",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InvalidParametersError"
                }
              }
            }
          },
          "401": {
            "description": "Authentification requise - L'utilisateur doit fournir un token Bearer valide dans l'en-tête Authorization. Cette erreur survient si le token est manquant, invalide ou expiré.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UnauthorizedError"
                }
              }
            }
          }
        }
      }
    },
    "/produits/tous": {
      "get": {
        "tags": ["Consultation"],
        "summary": "Récupère tous les produits publics disponibles",
        "description": "Permet de consulter la liste paginée de tous les produits avec le statut 'Done' (validés), dédupliqués par GTIN. Pour chaque GTIN, seul le produit le plus récent est retourné. Cette route est publique et ne nécessite pas d'authentification.",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "Numéro de la page à récupérer (commence à 0)",
            "example": 0
          },
          {
            "name": "size",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 500,
              "default": 100
            },
            "description": "Nombre d'éléments par page (maximum 500)",
            "example": 100
          }
        ],
        "responses": {
          "200": {
            "description": "Liste paginée des produits publics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "gtin": {
                            "type": "string",
                            "description": "Code GTIN du produit"
                          },
                          "internalReference": {
                            "type": "string",
                            "description": "Référence interne du produit"
                          },
                          "brand": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string",
                                "description": "Nom de la marque"
                              }
                            }
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time",
                            "description": "Date de création de la déclaration"
                          },
                          "category": {
                            "type": "string",
                            "description": "Catégorie du produit"
                          },
                          "score": {
                            "$ref": "#/components/schemas/ProductScore"
                          },
                          "upload": {
                            "type": "object",
                            "properties": {
                              "version": {
                                "type": "string",
                                "description": "Version de la déclaration"
                              },
                              "createdBy": {
                                "type": "object",
                                "properties": {
                                  "organization": {
                                    "type": "object",
                                    "properties": {
                                      "name": {
                                        "type": "string",
                                        "description": "Nom de l'organisation"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "pagination": {
                      "type": "object",
                      "properties": {
                        "page": {
                          "type": "integer",
                          "description": "Numéro de la page actuelle"
                        },
                        "size": {
                          "type": "integer",
                          "description": "Nombre d'éléments par page"
                        },
                        "total": {
                          "type": "integer",
                          "description": "Nombre total d'éléments uniques (GTINs)"
                        },
                        "totalPages": {
                          "type": "integer",
                          "description": "Nombre total de pages"
                        }
                      }
                    }
                  }
                },
                "example": {
                  "data": [
                    {
                      "gtin": "1234567890123",
                      "internalReference": "REF-123",
                      "brand": {
                        "name": "Marque A"
                      },
                      "createdAt": "2025-11-27T10:00:00Z",
                      "category": "T-shirt",
                      "score": {
                        "score": 1404.965599718265,
                        "standardized": 936.6437331455104,
                        "durability": 0.67,
                        "acd": 0.04195569657855826,
                        "cch": 7.74213460144599,
                        "etf": 305.9071623783734,
                        "fru": 99.54550743506823,
                        "fwe": 0.001226779343506402,
                        "ior": 9.453062345833024,
                        "ldu": 102.9176328600372,
                        "mru": 0.00002244465726084131,
                        "ozd": 1.904132357839134e-7,
                        "pco": 0.03029830439785,
                        "pma": 5.17488501906917e-7,
                        "swe": 0.0245479277707963,
                        "tre": 0.1024326352422391,
                        "wtu": 2.089747384008741,
                        "microfibers": 55.97014925373134,
                        "outOfEuropeEOL": 54.85074626865671,
                        "materials": 410.5263602338779,
                        "spinning": 42.6176992142446,
                        "fabric": 30.19844148041522,
                        "dyeing": 201.2995480190762,
                        "making": 26.750412,
                        "usage": 106.7891634,
                        "endOfLife": 41.73391728,
                        "transport": 80.60366918362402,
                        "trims": 0.8077410000000782
                      },
                      "upload": {
                        "version": "7.0.0",
                        "createdBy": {
                          "organization": {
                            "name": "Organisation A"
                          }
                        }
                      }
                    }
                  ],
                  "pagination": {
                    "page": 0,
                    "size": 100,
                    "total": 1250,
                    "totalPages": 13
                  }
                }
              }
            }
          },
          "400": {
            "description": "Paramètres de pagination invalides",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    }
                  }
                },
                "example": {
                  "error": "Invalid pagination parameters"
                }
              }
            }
          }
        }
      }
    },
    "/produits/{gtin}": {
      "get": {
        "tags": ["Consultation"],
        "summary": "Récupère les informations d'un produit par son GTIN",
        "description": "Permet de consulter les informations et le score environnemental d'un produit déclaré en utilisant son code GTIN",
        "parameters": [
          {
            "name": "gtin",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^\\d{8}|\\d{13}$"
            },
            "description": "Le code GTIN du produit (8 ou 13 chiffres)",
            "example": "1234567890123"
          }
        ],
        "responses": {
          "200": {
            "description": "Informations du produit trouvé",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductResponse"
                }
              }
            }
          },
          "404": {
            "description": "Produit non trouvé pour ce GTIN",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotFoundError"
                }
              }
            }
          }
        }
      }
    },
    "/produits/{gtin}/historique": {
      "get": {
        "tags": ["Consultation"],
        "summary": "Récupère l'historique des versions d'un produit par son GTIN",
        "description": "Permet de consulter l'historique complet des différentes versions d'un produit déclaré en utilisant son code GTIN, avec pagination",
        "parameters": [
          {
            "name": "gtin",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^\\d{8}|\\d{13}$"
            },
            "description": "Le code GTIN du produit (8 ou 13 chiffres)",
            "example": "1234567890123"
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "Numéro de la page à récupérer (commence à 0)",
            "example": 1
          },
          {
            "name": "size",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 10
            },
            "description": "Nombre d'éléments par page (maximum 100)",
            "example": 10
          }
        ],
        "responses": {
          "200": {
            "description": "Historique paginé du produit",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ProductResponse"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Paramètres invalides",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InvalidParametersError"
                }
              }
            }
          }
        }
      }
    },
    "/image": {
      "get": {
        "tags": ["Affichage Environnemental"],
        "summary": "Génère l'image SVG de l'Affichage Environnemental",
        "parameters": [
          {
            "name": "type",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "enum": ["score", "gtin"]
            },
            "description": "Type des paramètres pour l'image à générer, soit `score` pour l'image avec le score, soit `gtin` pour l'image avec le GTIN du produit"
          },
          {
            "name": "gtin",
            "in": "query",
            "schema": {
              "type": "string",
              "pattern": "^\\d{8}|\\d{13}$"
            },
            "description": "Le GTIN du produit, format 8 ou 13 chiffres. Doit être fourni si `type` est `gtin`"
          },
          {
            "name": "score",
            "in": "query",
            "schema": {
              "type": "number"
            },
            "description": "Le score du produit, doit être fourni si `type` est `score`"
          },
          {
            "name": "masse",
            "in": "query",
            "schema": {
              "type": "number"
            },
            "description": "La masse du produit (en kg), doit être fournie si `type` est `score`"
          }
        ],
        "responses": {
          "200": {
            "description": "Image SVG du produit",
            "content": {
              "image/svg+xml": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "400": {
            "description": "Paramètres invalides",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InvalidParametersError"
                }
              }
            }
          },
          "404": {
            "description": "Produit non trouvé ou sans score pour ce GTIN"
          }
        }
      }
    },
    "/organisation": {
      "get": {
        "security": [
          {
            "bearer": []
          }
        ],
        "tags": ["Consultation"],
        "summary": "Récupère les informations de son organisation",
        "description": "Permet de consulter les informations complètes de l'organisation de l'utilisateur authentifié. Cette route nécessite un token d'authentification valide. Les informations retournées incluent les marques de l'organisation et les relations d'autorisation (délégations) bidirectionnelles avec d'autres organisations.",
        "responses": {
          "200": {
            "description": "Informations de l'organisation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrganizationResponse"
                },
                "example": {
                  "name": "Ma Société",
                  "disaplayName": "Société A",
                  "brands": [
                    { "id": "8fb367e1-42d9-4665-9d79-9395428a83a8", "name": "Ma Marque Premium" },
                    { "id": "c18138f6-b445-49b1-83fc-7594d301e845", "name": "Ma Marque Eco" }
                  ],
                  "authorizedOrganizations": [
                    {
                      "createdAt": "2025-10-03T10:30:00Z",
                      "to": {
                        "name": "Société Partenaire",
                        "siret": "98765432109876"
                      }
                    }
                  ],
                  "authorizedBy": [
                    {
                      "createdAt": "2025-09-15T14:20:00Z",
                      "from": {
                        "name": "Société Mère",
                        "siret": "11223344556677",
                        "brands": [{ "name": "Marque A", "id": "a1b2c3d4-e5f6-7890-ab12-cd34ef56gh78" }]
                      }
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Authentification requise - L'utilisateur doit fournir un token Bearer valide dans l'en-tête Authorization. Cette erreur survient si le token est manquant, invalide ou expiré.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UnauthorizedError"
                }
              }
            }
          },
          "404": {
            "description": "Pas d'information sur l'organisation.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotFoundError"
                }
              }
            }
          },
          "500": {
            "description": "Erreur interne du serveur",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Erreur interne du serveur"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearer": {
        "description": "Cette clé API, permet de vous identifier. Vous pouvez gerer vos clés dans la rubrique *API*",
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "UUID"
      }
    },
    "examples": {
      "tShirtFrance": {
        "summary": "T-Shirt France 100% Coton",
        "value": {
          "gtins": ["1234567890123", "1234567890124"],
          "internalReference": "REF-123",
          "brandId": "ca209b2c-ae68-4d93-b665-be7c77380f71",
          "mass": 0.17,
          "materials": [
            {
              "id": "ei-coton",
              "share": 1,
              "country": "FR"
            }
          ],
          "product": "tshirt",
          "countrySpinning": "FR",
          "countryFabric": "FR",
          "countryDyeing": "FR",
          "countryMaking": "FR",
          "fabricProcess": "knitting-mix"
        }
      },
      "lotTShirts": {
        "summary": "Lot de T-Shirt/Pantalon",
        "value": {
          "gtins": ["1234567890128"],
          "internalReference": "LOT-456",
          "brandId": "74a1ce48-56e1-452e-ba9b-0c55fae4ed85",
          "price": 45,
          "numberOfReferences": 1500,
          "products": [
            {
              "mass": 0.17,
              "materials": [
                {
                  "id": "ei-coton",
                  "share": 1,
                  "country": "FR"
                }
              ],
              "product": "tshirt",
              "countrySpinning": "FR",
              "countryFabric": "FR",
              "countryDyeing": "FR",
              "countryMaking": "FR"
            },
            {
              "mass": 0.15,
              "materials": [
                {
                  "id": "ei-coton",
                  "share": 0.8,
                  "country": "FR"
                },
                {
                  "id": "ei-pet",
                  "share": 0.2,
                  "country": "CN"
                }
              ],
              "product": "pantalon",
              "countrySpinning": "FR",
              "countryFabric": "FR",
              "countryDyeing": "FR",
              "countryMaking": "BD",
              "printing": {
                "kind": "pigment",
                "ratio": 0.2
              }
            }
          ]
        }
      }
    },
    "schemas": {
      "OrganizationSummary": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Nom de l'organisation",
            "example": "Société Partenaire"
          },
          "siret": {
            "type": "string",
            "description": "SIRET de l'organisation",
            "example": "12345678901234"
          }
        }
      },
      "OrganizationWithBrands": {
        "allOf": [
          {
            "$ref": "#/components/schemas/OrganizationSummary"
          },
          {
            "type": "object",
            "properties": {
              "brands": {
                "type": "array",
                "description": "Marques de l'organisation",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "description": "ID de la marque",
                      "example": "b1a2c3d4-e5f6-7890-ab12-cd34ef56gh78"
                    },
                    "name": {
                      "type": "string",
                      "description": "Nom de la marque",
                      "example": "Ma Marque Premium"
                    }
                  }
                }
              }
            }
          }
        ]
      },
      "Authorization": {
        "type": "object",
        "properties": {
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Date de création de l'autorisation",
            "example": "2025-10-03T10:30:00Z"
          }
        },
        "required": ["createdAt"]
      },
      "AuthorizedOrganization": {
        "allOf": [
          {
            "$ref": "#/components/schemas/Authorization"
          },
          {
            "type": "object",
            "properties": {
              "to": {
                "$ref": "#/components/schemas/OrganizationSummary"
              }
            },
            "required": ["to"]
          }
        ]
      },
      "AuthorizingOrganization": {
        "allOf": [
          {
            "$ref": "#/components/schemas/Authorization"
          },
          {
            "type": "object",
            "properties": {
              "from": {
                "$ref": "#/components/schemas/OrganizationWithBrands"
              }
            },
            "required": ["from"]
          }
        ]
      },
      "OrganizationResponse": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Nom de l'organisation",
            "example": "Ma Société"
          },
          "displayName": {
            "type": "string",
            "description": "Nom d'usage de l'organisation",
            "example": "Société A"
          },
          "brands": {
            "type": "array",
            "description": "Liste des marques de l'organisation",
            "items": { "type": "string" }
          },
          "authorizedOrganizations": {
            "type": "array",
            "description": "Liste des organisations qui peuvent déclarer des produits pour vous",
            "items": {
              "$ref": "#/components/schemas/AuthorizedOrganization"
            }
          },
          "authorizedBy": {
            "type": "array",
            "description": "Liste des organisations vous autorisent à déclarer des produits pour elles",
            "items": {
              "$ref": "#/components/schemas/AuthorizingOrganization"
            }
          }
        },
        "required": ["name", "brands", "authorizedOrganizations", "authorizedBy"]
      },
      "ProductQuery": {
        "type": "object",
        "additionalProperties": false,
        "required": ["gtins", "internalReference", "mass", "materials", "product", "countryMaking"],
        "properties": {
          "gtins": {
            "type": "array",
            "description": "Les codes GTIN (ou EAN) du produit, format 13 ou 8 chiffres",
            "items": {
              "type": "string",
              "pattern": "^(\\d{8}|\\d{13})$",
              "example": "1234567890123"
            }
          },
          "internalReference": {
            "type": "string",
            "description": "Référence interne du produit",
            "example": "REF-123"
          },
          "brandId": {
            "type": "string",
            "description": "Marque id du produit"
          },
          "declaredScore": {
            "type": "number",
            "description": "Dans l'hypothèse où vous ne déclarez pas ce champ, le calcul sera effectué automatiquement conformément à vos déclarations. Le score calculé demeure sous votre responsabilité. [Consultez la méthode de calcul](/notice-reglementaire.pdf)."
          },
          "mass": {
            "type": "number",
            "description": "Masse du produit fini, en kilogrammes",
            "minimum": 0.01,
            "example": 0.17
          },
          "product": {
            "type": "string",
            "description": "Identifiant du produit (liste disponible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/products`)",
            "enum": [
              "chemise",
              "jean",
              "jupe",
              "manteau",
              "pantalon",
              "pull",
              "tshirt",
              "chaussettes",
              "calecon",
              "slip",
              "maillot-de-bain"
            ]
          },
          "materials": {
            "type": "array",
            "description": "Liste des matières composant le vêtement",
            "items": {
              "$ref": "#/components/schemas/ProductQueryMaterial"
            },
            "minItems": 1
          },
          "airTransportRatio": {
            "type": "number",
            "description": "Part de **transport aérien** entre l'étape de **Confection** et l'étape de **Distribution**, entre `0` et `1`",
            "minimum": 0,
            "maximum": 1
          },
          "business": {
            "type": "string",
            "description": "Type d'entreprise et d'offre de services :<br/>- `small-business` : TPE/PME<br/>- `large-business-with-services` : Grande entreprise avec service de réparation<br/>- `large-business-without-services` (par défaut): Grande entreprise sans service de réparation",
            "enum": ["small-business", "large-business-with-services", "large-business-without-services"]
          },
          "countryDyeing": {
            "type": "string",
            "description": "Code pays pour l'étape de **Teinture** (liste disponible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/countries`)<br/>Ce champs est requis si `upcycled` n'est pas `true`.",
            "minLength": 2,
            "maxLength": 3
          },
          "countryFabric": {
            "type": "string",
            "description": "Code pays pour l'étape de **Tissage/Tricotage** (liste disponible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/countries`)<br/>Ce champs est requis si `upcycled` n'est pas `true`.",
            "minLength": 2,
            "maxLength": 3
          },
          "countryMaking": {
            "type": "string",
            "description": "Code pays pour l'étape de **Confection** (liste disponible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/countries`)",
            "minLength": 2,
            "maxLength": 3
          },
          "countrySpinning": {
            "type": "string",
            "description": "Code pays pour l'étape de **Filature** (liste disponible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/countries`).<br/>Si non spécifié, le pays de filature pris en considération est celui de production de<br/>la matière la plus représentée dans le mix.",
            "minLength": 2,
            "maxLength": 3
          },
          "fading": {
            "type": "boolean",
            "description": "Active l'application du **procédé de délavage** pour l'étape de confection d'un produit."
          },
          "numberOfReferences": {
            "description": "Nombre de références au catalogue de la marque.",
            "type": "number",
            "minimum": 1,
            "maximum": 999999
          },
          "price": {
            "description": "Prix du produit, en Euros (€).",
            "type": "number",
            "minimum": 1
          },
          "printing": {
            "type": "object",
            "description": "Ce paramètre permet de préciser le type d'impression effectuée sur le produit.<br/>Par exemple, `{\"kind\": \"pigment\", \"ratio\": 0.1}` signifie impression pigmentaire sur 10%<br/>de la superficie du vêtement.",
            "required": ["kind"],
            "properties": {
              "kind": {
                "type": "string",
                "description": "Type de procédé d'impression pouvant prendre les valeurs suivantes :<br/>- `pigment` pour une impression pigmentaire ;<br/>- `substantive` pour une impression fixé/lavé ;",
                "enum": ["pigment", "substantive"]
              },
              "ratio": {
                "type": "number",
                "description": "Pourcentage de surface imprimée",
                "enum": [0.01, 0.05, 0.2, 0.5, 0.8]
              }
            }
          },
          "trims": {
            "description": "Liste des accessoires du vêtement (boutons, zip, etc).<br/>La liste des accessoires disponibles est accessible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/trims`.",
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "format": "uuid"
                },
                "quantity": {
                  "type": "integer",
                  "minimum": 0
                }
              }
            }
          },
          "upcycled": {
            "description": "Produit remanufacturé",
            "type": "boolean"
          }
        }
      },
      "ProductQueryMaterial": {
        "type": "object",
        "description": "Liste des matières composant le produit",
        "additionalProperties": false,
        "required": ["id", "share"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Identifiant de la matière, la liste des matières disponibles est accessible sur le<br/>point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/materials`"
          },
          "share": {
            "type": "number",
            "description": "Part du produit que cette matière représente (entre `0` et `1`)",
            "minimum": 0.01,
            "maximum": 1
          },
          "country": {
            "type": "string",
            "description": "Code du pays d'origine de la matière",
            "minLength": 2,
            "maxLength": 2
          }
        }
      },
      "ProductBatchQuery": {
        "type": "object",
        "additionalProperties": false,
        "required": ["gtins", "internalReference", "products"],
        "properties": {
          "gtins": {
            "type": "array",
            "description": "Les codes GTIN (ou EAN) du lot de produits, format 13 ou 8 chiffres",
            "items": {
              "type": "string",
              "pattern": "^(\\d{8}|\\d{13})$",
              "example": "1234567890123"
            }
          },
          "internalReference": {
            "type": "string",
            "description": "Référence interne du lot de produits",
            "example": "LOT-123"
          },
          "brandId": {
            "type": "string",
            "description": "Marque id commune du lot de produits"
          },
          "declaredScore": {
            "type": "number",
            "description": "Dans l'hypothèse où vous ne déclarez pas ce champ, le calcul sera effectué automatiquement conformément à vos déclarations. Le score calculé demeure sous votre responsabilité. [Consultez la méthode de calcul](/notice-reglementaire.pdf)."
          },
          "numberOfReferences": {
            "description": "Nombre de références au catalogue de la marque.",
            "type": "number",
            "minimum": 1,
            "maximum": 999999
          },
          "price": {
            "description": "Prix du lot de produit, en Euros (€).",
            "type": "number",
            "minimum": 1,
            "maximum": 1000
          },
          "products": {
            "type": "array",
            "description": "Liste des produits composant le lot",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": ["mass", "materials", "product", "countryMaking"],
              "properties": {
                "numberOfItem": {
                  "description": "Nombre d'articles de ce type dans le lot",
                  "default": 1,
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 999
                },
                "mass": {
                  "type": "number",
                  "description": "Masse du produit fini, en kilogrammes",
                  "minimum": 0.01,
                  "example": 0.17
                },
                "product": {
                  "type": "string",
                  "description": "Identifiant du produit (liste disponible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/products`)",
                  "enum": [
                    "chemise",
                    "jean",
                    "jupe",
                    "manteau",
                    "pantalon",
                    "pull",
                    "tshirt",
                    "chaussettes",
                    "calecon",
                    "slip",
                    "maillot-de-bain"
                  ]
                },
                "materials": {
                  "type": "array",
                  "description": "Liste des matières composant le vêtement",
                  "items": {
                    "$ref": "#/components/schemas/ProductQueryMaterial"
                  },
                  "minItems": 1
                },
                "airTransportRatio": {
                  "type": "number",
                  "description": "Part de **transport aérien** entre l'étape de **Confection** et l'étape de **Distribution**, entre `0` et `1`",
                  "minimum": 0,
                  "maximum": 1
                },
                "business": {
                  "type": "string",
                  "description": "Type d'entreprise et d'offre de services :<br/>- `small-business` : TPE/PME<br/>- `large-business-with-services` : Grande entreprise avec service de réparation<br/>- `large-business-without-services` (par défaut): Grande entreprise sans service de réparation",
                  "enum": ["small-business", "large-business-with-services", "large-business-without-services"]
                },
                "countryDyeing": {
                  "type": "string",
                  "description": "Code pays pour l'étape de **Teinture** (liste disponible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/countries`)<br/>Ce champs est requis si `upcycled` n'est pas `true`.",
                  "minLength": 2,
                  "maxLength": 3
                },
                "countryFabric": {
                  "type": "string",
                  "description": "Code pays pour l'étape de **Tissage/Tricotage** (liste disponible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/countries`)<br/>Ce champs est requis si `upcycled` n'est pas `true`.",
                  "minLength": 2,
                  "maxLength": 3
                },
                "countryMaking": {
                  "type": "string",
                  "description": "Code pays pour l'étape de **Confection** (liste disponible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/countries`)",
                  "minLength": 2,
                  "maxLength": 3
                },
                "countrySpinning": {
                  "type": "string",
                  "description": "Code pays pour l'étape de **Filature** (liste disponible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/countries`).<br/>Si non spécifié, le pays de filature pris en considération est celui de production de<br/>la matière la plus représentée dans le mix.",
                  "minLength": 2,
                  "maxLength": 3
                },
                "fading": {
                  "type": "boolean",
                  "description": "Active l'application du **procédé de délavage** pour l'étape de confection d'un produit."
                },
                "printing": {
                  "type": "object",
                  "description": "Ce paramètre permet de préciser le type d'impression effectuée sur le produit.<br/>Par exemple, `{\"kind\": \"pigment\", \"ratio\": 0.1}` signifie impression pigmentaire sur 10%<br/>de la superficie du vêtement.",
                  "required": ["kind"],
                  "properties": {
                    "kind": {
                      "type": "string",
                      "description": "Type de procédé d'impression pouvant prendre les valeurs suivantes :<br/>- `pigment` pour une impression pigmentaire ;<br/>- `substantive` pour une impression fixé/lavé ;",
                      "enum": ["pigment", "substantive"]
                    },
                    "ratio": {
                      "type": "number",
                      "description": "Pourcentage de surface imprimée",
                      "enum": [0.01, 0.05, 0.2, 0.5, 0.8]
                    }
                  }
                },
                "trims": {
                  "description": "Liste des accessoires du vêtement (boutons, zip, etc).<br/>La liste des accessoires disponibles est accessible sur le point d'entrée `https://ecobalyse.beta.gouv.fr/versions/v7.0.0/api/textile/trims`.",
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "quantity": {
                        "type": "integer",
                        "minimum": 0
                      }
                    }
                  }
                },
                "upcycled": {
                  "description": "Produit remanufacturé",
                  "type": "boolean"
                }
              }
            }
          }
        }
      },
      "ProductResponse": {
        "type": "object",
        "description": "Informations complètes d'un produit avec son score environnemental",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "Identifiant unique du produit"
          },
          "gtins": {
            "type": "array",
            "description": "Liste des codes GTIN associés au produit",
            "items": {
              "type": "string",
              "pattern": "^(\\d{8}|\\d{13})$"
            }
          },
          "internalReference": {
            "type": "string",
            "description": "Référence interne du produit"
          },
          "brand": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Marque du produit"
              }
            }
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Date de création de la déclaration"
          },
          "category": {
            "type": "string",
            "description": "Catégorie du produit"
          },
          "score": {
            "$ref": "#/components/schemas/ProductScore"
          },
          "upload": {
            "$ref": "#/components/schemas/UploadInfo"
          }
        },
        "example": {
          "id": "7a183a57-e5bc-4170-a770-66654281aab9",
          "gtins": ["8546241205910"],
          "internalReference": "015Q8sUpK3",
          "brand": "Emmaus",
          "createdAt": "2025-08-08T10:17:58.231Z",
          "category": "Chaussettes",
          "score": {
            "score": 1404.965599718265,
            "standardized": 936.6437331455104,
            "durability": 0.67,
            "acd": 0.04195569657855826,
            "cch": 7.74213460144599,
            "etf": 305.9071623783734,
            "fru": 99.54550743506823,
            "fwe": 0.001226779343506402,
            "ior": 9.453062345833024,
            "ldu": 102.9176328600372,
            "mru": 0.00002244465726084131,
            "ozd": 1.904132357839134e-7,
            "pco": 0.03029830439785,
            "pma": 5.17488501906917e-7,
            "swe": 0.0245479277707963,
            "tre": 0.1024326352422391,
            "wtu": 2.089747384008741,
            "microfibers": 55.97014925373134,
            "outOfEuropeEOL": 54.85074626865671,
            "materials": 410.5263602338779,
            "spinning": 42.6176992142446,
            "fabric": 30.19844148041522,
            "dyeing": 201.2995480190762,
            "making": 26.750412,
            "usage": 106.7891634,
            "endOfLife": 41.73391728,
            "transport": 80.60366918362402,
            "trims": 0.8077410000000782
          },
          "upload": {
            "version": "7.0.0",
            "createdBy": {
              "organization": {
                "name": "Ecopass"
              },
              "nom": "Dane",
              "prenom": "Jane"
            }
          }
        }
      },
      "ProductScore": {
        "type": "object",
        "description": "Score environnemental du produit",
        "properties": {
          "score": {
            "type": "number",
            "description": "Score environnemental total (en points)"
          },
          "standardized": {
            "type": "number",
            "description": "Score environnemental standardisé pour 100g"
          },
          "durability": {
            "type": "number",
            "description": "Coefficient de durabilité du produit"
          },
          "acd": {
            "type": "number",
            "description": "Impact - Acidification (en points)"
          },
          "cch": {
            "type": "number",
            "description": "Impact - Changement climatique (en points)"
          },
          "etf": {
            "type": "number",
            "description": "Impact - Écotoxicité pour écosystèmes d'eau douce, corrigée (en points)"
          },
          "fru": {
            "type": "number",
            "description": "Impact - Épuisement des ressources fossiles (en points)"
          },
          "fwe": {
            "type": "number",
            "description": "Impact - Eutrophisation eaux douces (en points)"
          },
          "ior": {
            "type": "number",
            "description": "Impact - Rayonnements ionisants (en points)"
          },
          "ldu": {
            "type": "number",
            "description": "Impact - Occupation des sols (en points)"
          },
          "mru": {
            "type": "number",
            "description": "Impact - Épuisement des ressources minéraux et métaux (en points)"
          },
          "ozd": {
            "type": "number",
            "description": "Impact - Appauvrissement de la couche d'ozone (en points)"
          },
          "pco": {
            "type": "number",
            "description": "Impact - Formation photochimique d'ozone (en points)"
          },
          "pma": {
            "type": "number",
            "description": "Impact - Particules (en points)"
          },
          "swe": {
            "type": "number",
            "description": "Impact - Eutrophisation marine (en points)"
          },
          "tre": {
            "type": "number",
            "description": "Impact - Eutrophisation terrestre (en points)"
          },
          "wtu": {
            "type": "number",
            "description": "Impact - Consommation d'eau (en points)"
          },
          "microfibers": {
            "type": "number",
            "description": "Impact - Émission de microfibres (en points)"
          },
          "outOfEuropeEOL": {
            "type": "number",
            "description": "Impact - Fin de vie hors Europe (en points)"
          },
          "materials": { "type": "number", "description": "Cycle de vie - Matières premières (en points)" },
          "spinning": { "type": "number", "description": "Cycle de vie - Filature (en points)" },
          "fabric": { "type": "number", "description": "Cycle de vie - Tissage & Tricotage (en points)" },
          "dyeing": { "type": "number", "description": "Cycle de vie - Ennoblissement (en points)" },
          "making": { "type": "number", "description": "Cycle de vie - Confection (en points)" },
          "usage": { "type": "number", "description": "Cycle de vie - Utilisation (en points)" },
          "endOfLife": { "type": "number", "description": "Cycle de vie - Fin de vie (en points)" },
          "transport": { "type": "number", "description": "Cycle de vie - Transport (en points)" },
          "trims": { "type": "number", "description": "Cycle de vie - Accessoires (en points)" }
        }
      },
      "UploadInfo": {
        "type": "object",
        "description": "Informations sur la déclaration",
        "properties": {
          "version": {
            "type": "string",
            "description": "Version de la déclaration"
          },
          "createdBy": {
            "type": "object",
            "description": "Informations sur l'utilisateur ayant effectué la déclaration",
            "properties": {
              "organization": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Nom de l'organisation"
                  }
                }
              },
              "nom": {
                "type": "string",
                "description": "Nom de l'utilisateur"
              },
              "prenom": {
                "type": "string",
                "description": "Prénom de l'utilisateur"
              }
            }
          }
        }
      },
      "NotFoundError": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Message d'erreur",
            "example": "Objet non trouvé"
          }
        }
      },
      "UnauthorizedError": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Message d'erreur d'authentification",
            "example": "Token d'authentification invalide"
          }
        }
      },
      "InvalidParametersError": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "code": {
              "type": "string",
              "description": "Code d'erreur, par exemple `invalid_parameters`"
            },
            "message": {
              "type": "string",
              "description": "Message d'erreur décrivant le problème"
            },
            "path": {
              "type": "array",
              "description": "Chemin des paramètres invalides dans la requête",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    }
  },
  "version": "v0.1.0"
}
